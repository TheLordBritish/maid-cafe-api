version: '3.3'
services:
  db:
    container_name: traklibrary-db
    image: postgres:9.6
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=postgres
    volumes:
      - trak-db-data:/var/lib/postgresql/data
      - ./scripts/db:/docker-entrypoint-initdb.d
    ports:
      - 5433:5432
    networks:
      - trak-network

  auth-server:
    image: sparkystudios/traklibrary-auth-server:latest
    build:
      context: ./auth-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    depends_on:
      - db
      - discovery-server
      - config-server
    ports:
      - 8081:8080
      - 5005:5005

  config-server:
    image: sparkystudios/traklibrary-config-server:latest
    build:
      context: ./config-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    ports:
      - 8888:8888
      - 5006:5005

  discovery-server:
    image: sparkystudios/traklibrary-discovery-server:latest
    build:
      context: ./discovery-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    ports:
      - 8761:8761
      - 5007:5005

  email-server:
    image: sparkystudios/traklibrary-email-server:latest
    build:
      context: ./email-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    ports:
      - 8082:8080
      - 5008:5005

  game-server:
    image: sparkystudios/traklibrary-game-server:latest
    build:
      context: ./game-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    depends_on:
      - db
      - discovery-server
      - config-server
    ports:
      - 8083:8080
      - 5009:5005

  gateway-server:
    image: sparkystudios/traklibrary-gateway-server:latest
    build:
      context: ./gateway-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    ports:
      - 8080:8080
      - 5010:5005

  image-server:
    image: sparkystudios/traklibrary-image-server:latest
    build:
      context: ./image-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    ports:
      - 8084:8080
      - 5011:5005

  notification-server:
    image: sparkystudios/traklibrary-notification-server:latest
    build:
      context: ./notification-server
    volumes:
      - ./logs:/app/logs
    environment:
      - spring.profiles.active=development
    depends_on:
      - db
      - discovery-server
      - config-server
    ports:
      - 8085:8080
      - 5012:5005

volumes:
  trak-db-data: